description: "IOF iozone test cmds."

defaultENV:

    CRT_LOG_MASK: "INFO"

module:

    name:        "iozone_iof"
    logBaseName: "iozone_iof"
    path:        "$PWD/scripts"

directives:

    testMode: "scripts"

subList:

    nodename:    node
    iozone_path: "/usr/bin"

execStrategy:

    - name:       "iof_iozone_help"
      exe:        "{iozone_path}/iozone"
      type:       exe
      parameters: "-h"

    - name:       "iof_mkdir"
      exe:        "/usr/bin/mkdir"
      type:       exe
      parameters: "-p {CNSS_PREFIX}/FS_2/{nodename}"

    # Iozone write test.
    - name:       "iof_iozone_write"
      exe:        "{iozone_path}/iozone"
      type:       exe
      parameters: "-i 0 -t 1 -c –e –r 1024k –s 25g -+n -F \
                   {CNSS_PREFIX}/FS_2/{nodename}/test.bin"

    # Generate test.bin for iozone read test.
    # NOTE: test.bin contains 0x3a (supported by older version of iozone) or
    #       0xdb (supported by newer version of iozone).
    - name:       "iof_dd_pipe_tr"
      exe:        "/usr/bin/dd"
      type:       exe
      parameters: "status=none bs=1 count=512k if=/dev/zero | \
                   tr \'\\0\' \'\\72\' > {CNSS_PREFIX}/FS_2/{nodename}/test.bin"

    # Iozone read test.
    - name:       "iof_iozone_read"
      exe:        "{iozone_path}/iozone"
      type:       exe
      parameters: "-i 1 -t 1 -c –e –r 1024k –s 25g -+n -F \
                   {CNSS_PREFIX}/FS_2/{nodename}/test.bin"

    # Generate test.bin for iozone random (read/write) test.
    # NOTE: test.bin contains 0x3a (supported by older version of iozone) or
    #       0xdb (supported by newer version of iozone).
    - name:       "iof_dd_pipe_tr"
      exe:        "/usr/bin/dd"
      type:       exe
      parameters: "status=none bs=1 count=512k if=/dev/zero | \
                   tr \'\\0\' \'\\72\' > {CNSS_PREFIX}/FS_2/{nodename}/test.bin"

    # Generate test.bin for iozone random (read/write) test.
    # NOTE: YAML parser does not allow escaped octal chars in the cmd or
    #       parameter, hence this shell script approach can be used as an
    #       alternative to execStrategy entry named "iof_dd_pipe_tr".
    # - name:       "iof_dd_tr"
    #   exe:        "iozone_dd_tr"
    #   type:       shell
    #   parameters: "{CNSS_PREFIX}/FS_2/{nodename}/test.bin"

    # Iozone random test.
    - name:       "iof_iozone_random"
      exe:        "{iozone_path}/iozone"
      type:       exe
      parameters: "-i 2 -t 1 -c –e –r 1024k –s 25g -+n -F \
                   {CNSS_PREFIX}/FS_2/{nodename}/test.bin"
